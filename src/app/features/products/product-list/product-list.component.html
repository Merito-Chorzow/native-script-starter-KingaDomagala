<ActionBar title="Scan Inventory" class="action-bar">
  <ActionItem
    ios.position="right"
    android.position="actionBar"
    text="âš™ï¸"
    (tap)="onSettingsTap()"
  ></ActionItem>
</ActionBar>

<GridLayout rows="auto, auto, *" class="page">
  <!-- Search Bar -->
  <GridLayout row="0" columns="*, auto" class="search-container">
    <SearchBar
      col="0"
      [text]="searchQuery"
      (textChange)="onSearchTextChange($event)"
      (submit)="onSearchSubmit($event)"
      (loaded)="onSearchBarLoaded($event)"
      class="search-bar"
    ></SearchBar>
    <Button
      col="1"
      text="ðŸ“·"
      class="scan-button"
      (tap)="onScanProduct()"
    ></Button>
  </GridLayout>

  <!-- Stats Row -->
  <GridLayout row="1" columns="*, *, *" class="stats-container">
    <StackLayout col="0" class="stat-item">
      <Label [text]="products.length" class="stat-number"></Label>
      <Label text="Wszystkie" class="stat-label"></Label>
    </StackLayout>
    <StackLayout col="1" class="stat-item">
      <Label [text]="getInStockCount()" class="stat-number stat-green"></Label>
      <Label text="DostÄ™pne" class="stat-label"></Label>
    </StackLayout>
    <StackLayout col="2" class="stat-item">
      <Label [text]="getOutOfStockCount()" class="stat-number stat-red"></Label>
      <Label text="Brak" class="stat-label"></Label>
    </StackLayout>
  </GridLayout>

  <!-- Loading Indicator -->
  <ActivityIndicator
    row="2"
    *ngIf="isLoading"
    busy="true"
    class="activity-indicator"
  ></ActivityIndicator>

  <!-- Error Message -->
  <StackLayout row="2" *ngIf="errorMessage && !isLoading" class="error-container">
    <Label text="âš ï¸" class="error-icon"></Label>
    <Label [text]="errorMessage" class="error-text" textWrap="true"></Label>
    <Button text="SprÃ³buj ponownie" class="retry-button" (tap)="loadProducts()"></Button>
  </StackLayout>

  <!-- Empty State -->
  <StackLayout
    row="2"
    *ngIf="!isLoading && !errorMessage && filteredProducts.length === 0"
    class="empty-container"
  >
    <Label text="ðŸ“¦" class="empty-icon"></Label>
    <Label
      *ngIf="searchQuery"
      text="Brak wynikÃ³w dla wyszukiwania"
      class="empty-text"
    ></Label>
    <Label
      *ngIf="!searchQuery"
      text="Brak produktÃ³w"
      class="empty-text"
    ></Label>
    <Label
      *ngIf="!searchQuery"
      text="Dodaj pierwszy produkt uÅ¼ywajÄ…c przycisku poniÅ¼ej"
      class="empty-subtext"
      textWrap="true"
    ></Label>
  </StackLayout>

  <!-- Products List -->
  <ListView
    row="2"
    *ngIf="!isLoading && !errorMessage && filteredProducts.length > 0"
    [items]="filteredProducts"
    class="products-list"
    separatorColor="transparent"
  >
    <ng-template let-product="item">
      <GridLayout
        columns="auto, *, auto"
        rows="auto, auto"
        class="product-card"
        (tap)="onProductTap(product)"
      >
        <!-- Product Image/Icon -->
        <StackLayout col="0" rowSpan="2" class="product-image-container">
          <Image 
            *ngIf="product.imageUrl" 
            [src]="product.imageUrl" 
            class="product-image"
            stretch="aspectFill"
          ></Image>
          <Label *ngIf="!product.imageUrl" text="ðŸ“¦" class="product-icon"></Label>
        </StackLayout>

        <!-- Product Info -->
        <StackLayout col="1" row="0" class="product-info">
          <Label [text]="product.name" class="product-name" textWrap="false"></Label>
          <Label [text]="product.code" class="product-code"></Label>
        </StackLayout>

        <!-- Category & Quantity -->
        <StackLayout col="1" row="1" class="product-meta">
          <Label [text]="product.category" class="product-category"></Label>
          <Label [text]="'IloÅ›Ä‡: ' + product.quantity" class="product-quantity"></Label>
        </StackLayout>

        <!-- Status Badge -->
        <StackLayout col="2" rowSpan="2" class="status-container">
          <Label
            [text]="getStatusIcon(product.status)"
            [style.backgroundColor]="getStatusColor(product.status)"
            class="status-badge"
          ></Label>
          <Label
            [text]="getStatusText(product.status)"
            [style.color]="getStatusColor(product.status)"
            class="status-text"
          ></Label>
        </StackLayout>
      </GridLayout>
    </ng-template>
  </ListView>

  <!-- FAB Add Button -->
  <Button
    row="2"
    text="+"
    class="fab-button"
    (tap)="onAddProduct()"
  ></Button>
</GridLayout>

